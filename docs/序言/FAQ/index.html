<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-序言/FAQ/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">FAQ | PikiwiDB(Pika)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.pikiwidb.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.pikiwidb.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.pikiwidb.com/docs/序言/FAQ/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="FAQ | PikiwiDB(Pika)"><meta data-rh="true" name="description" content="1 编译安装"><meta data-rh="true" property="og:description" content="1 编译安装"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.pikiwidb.com/docs/序言/FAQ/"><link data-rh="true" rel="alternate" href="https://www.pikiwidb.com/docs/序言/FAQ/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://www.pikiwidb.com/docs/序言/FAQ/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="PikiwiDB(Pika) RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="PikiwiDB(Pika) Atom Feed">



<link rel="stylesheet" href="/css/katex.min.css"><link rel="stylesheet" href="/assets/css/styles.bf00f426.css">
<script src="/assets/js/runtime~main.1d65a15b.js" defer="defer"></script>
<script src="/assets/js/main.18633cb7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/PikiwiDB-Logo.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/PikiwiDB-Logo.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/序言">文档</a><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/序言/">序言</a><button aria-label="折叠侧边栏分类 &#x27;序言&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/序言/简介/">PikiwiDB(Pika) 简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/序言/支持的 Redis 接口与兼容情况/">支持的 Redis 接口与兼容情况</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/序言/FAQ/">FAQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/使用与运维/">使用与运维</a><button aria-label="展开侧边栏分类 &#x27;使用与运维&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/性能与优化/">性能与优化</a><button aria-label="展开侧边栏分类 &#x27;性能与优化&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/设计与实现/">设计与实现</a><button aria-label="展开侧边栏分类 &#x27;设计与实现&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/开发文档/">编码规范</a><button aria-label="展开侧边栏分类 &#x27;编码规范&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/序言/"><span itemprop="name">序言</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">FAQ</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>FAQ</h1></header><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-编译安装">1 编译安装<a class="hash-link" aria-label="1 编译安装的直接链接" title="1 编译安装的直接链接" href="/docs/序言/FAQ/#1-编译安装">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q1-支持的系统">Q1: 支持的系统？<a class="hash-link" aria-label="Q1: 支持的系统？的直接链接" title="Q1: 支持的系统？的直接链接" href="/docs/序言/FAQ/#q1-支持的系统">​</a></h4>
<p>A1： 目前支持 Linux 和 MacOS 系统，不支持 Windows</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q2-怎么编译安装">Q2: 怎么编译安装？<a class="hash-link" aria-label="Q2: 怎么编译安装？的直接链接" title="Q2: 怎么编译安装？的直接链接" href="/docs/序言/FAQ/#q2-怎么编译安装">​</a></h4>
<p>A2： 参考编译安装 wiki</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q3-ubuntu-编译偶尔报错-isnan-isinf-was-not-declared">Q3： Ubuntu 编译偶尔报错 isnan isinf was not declared？<a class="hash-link" aria-label="Q3： Ubuntu 编译偶尔报错 isnan isinf was not declared？的直接链接" title="Q3： Ubuntu 编译偶尔报错 isnan isinf was not declared？的直接链接" href="/docs/序言/FAQ/#q3-ubuntu-编译偶尔报错-isnan-isinf-was-not-declared">​</a></h4>
<p>A3： 一些旧版本的 pika 对 Ubuntu 环境兼容不好，某些情况下会出现；可以先修改代码，用 std::isnan 和 std::isinf 替代 isnan，isinf, 并包含头文件 <code>#include &lt;cmath&gt;</code>。 我们会在新版兼容这个。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-设计与实现">2 设计与实现<a class="hash-link" aria-label="2 设计与实现的直接链接" title="2 设计与实现的直接链接" href="/docs/序言/FAQ/#2-设计与实现">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q1-为什么要开那么多线程比如-purge搞个定时任务不就好了难道编程框架不支持定时器">Q1: 为什么要开那么多线程？比如 purge，搞个定时任务不就好了。难道编程框架不支持定时器？<a class="hash-link" aria-label="Q1: 为什么要开那么多线程？比如 purge，搞个定时任务不就好了。难道编程框架不支持定时器？的直接链接" title="Q1: 为什么要开那么多线程？比如 purge，搞个定时任务不就好了。难道编程框架不支持定时器？的直接链接" href="/docs/序言/FAQ/#q1-为什么要开那么多线程比如-purge搞个定时任务不就好了难道编程框架不支持定时器">​</a></h4>
<p>A1: pika 有一些比较耗时的任务，如删 binlog，扫描 key，备份，同步数据文件等等，为了不影响正常的用户请求，这些任务都是放到后台执  行的，并且将能并行的都放到不同线程里来最大程度上提升后台任务的执行速度；你说的变成框架是 pink 吗？pink 是支持定时器的，每一个 workerthread 只要用户定义了 cronhandle 和频率，就会定时执行要执行的内容，不过这时候 worker 是被独占的，响应不了用户请求，所以占时的任务最好还是单独开线程去做，redis 的 bio 也是这个原因</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q2-heartbeat-让-sender-做不就好了或者说-sender-有必要那么多线程吗">Q2: heartbeat 让 sender 做不就好了？或者说 sender 有必要那么多线程吗？<a class="hash-link" aria-label="Q2: heartbeat 让 sender 做不就好了？或者说 sender 有必要那么多线程吗？的直接链接" title="Q2: heartbeat 让 sender 做不就好了？或者说 sender 有必要那么多线程吗？的直接链接" href="/docs/序言/FAQ/#q2-heartbeat-让-sender-做不就好了或者说-sender-有必要那么多线程吗">​</a></h4>
<p>A2: 这主要有两个原因，第一为了提高同步速度，sender 只发不收，receiver 只收不发，心跳是又单独的线程去做，如果心跳又 sender 来做，那么为了一秒仅有一次的心跳还要去复杂化 sender 和 receiver 的逻辑；第二其实前期尝试过合并在一起来进行连接级别的存活检测，当写入压力过大的时候会心跳包的收发会延后，导致存活检测被影响，slave 误判 master 超时而进行不必要的重连</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q3-nemo-存储-hash-的实际-key第一个字节是header一个类型标记是说他是个-hash-类型">Q3: nemo 存储 hash 的实际 key，第一个字节是？header？一个类型标记？是说他是个 hash 类型？<a class="hash-link" aria-label="Q3: nemo 存储 hash 的实际 key，第一个字节是？header？一个类型标记？是说他是个 hash 类型？的直接链接" title="Q3: nemo 存储 hash 的实际 key，第一个字节 是？header？一个类型标记？是说他是个 hash 类型？的直接链接" href="/docs/序言/FAQ/#q3-nemo-存储-hash-的实际-key第一个字节是header一个类型标记是说他是个-hash-类型">​</a></h4>
<p>A3: 的确是一个 header，不过不是为了标记它是 hash，因为 nemo 底下已经将 string，hash，list，zset，set 这五个数据结构分成的 5 个库，互不影响，之所以有 header 是因为一个 hash 有一个 meta key 和一堆 field key，meta key 对应的 value 记录的是这个 hash 的基础信息，如 hash 的 size 等等，这个 header 也是区分 meta key 和 field key 用的</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q4-list-数据结构里面的-curr_seq-是个什么东西">Q4: list 数据结构里面的 curr_seq 是个什么东西？<a class="hash-link" aria-label="Q4: list 数据结构里面的 curr_seq 是个什么东西？的直接链接" title="Q4: list 数据结构里面的 curr_seq 是个什么东西？的直接链接" href="/docs/序言/FAQ/#q4-list-数据结构里面的-curr_seq-是个什么东西">​</a></h4>
<p>A4: list 的实现是完全基于 kv 实现的 list，通过 seq 来实现 list 类似 prev 和 next 指针，cur_seq 是在 meta 信息里的，也就是当前已经用到那个 seq 了，新来的节点从这个 seq 开始递增接着用</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q5-binlog-里面存储的是转化后的-putdelete还是存储的原生-redis-命令">Q5: binlog 里面存储的是转化后的 put，delete？还是存储的原生 redis 命令？<a class="hash-link" aria-label="Q5: binlog 里面存储的是转化后的 put，delete？还是存储的原生 redis 命令？的直接链接" title="Q5: binlog 里面存储的是转化后的 put，delete？还是存储的原生 redis 命令？的直接链接" href="/docs/序言/FAQ/#q5-binlog-里面存储的是转化后的-putdelete还是存储的原生-redis-命令">​</a></h4>
<p>A5: 存的是 redis 的命令</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q6-rsync-的-deamon-模式这个-rsync-是-linux-上的-rsync-命令">Q6: rsync 的 deamon 模式，这个 rsync 是 linux 上的 rsync 命令？<a class="hash-link" aria-label="Q6: rsync 的 deamon 模式，这个 rsync 是 linux 上的 rsync 命令？的直接链接" title="Q6: rsync 的 deamon 模式，这个 rsync 是 linux 上的 rsync 命令？的直接链接" href="/docs/序言/FAQ/#q6-rsync-的-deamon-模式这个-rsync-是-linux-上的-rsync-命令">​</a></h4>
<p>A6: 是的，pika 前期为了更快的实现全同步的功能，此处是直接调用 rsync 命令来完成数据文件的收发，也是由它来进行文件的续传校验等</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q7-dump-db-文件是-rocksdb-本身就带的功能具体怎么搞的">Q7: dump db 文件是 rocksdb 本身就带的功能？具体怎么搞的？<a class="hash-link" aria-label="Q7: dump db 文件是 rocksdb 本身就带的功能？具体怎么搞的？的直接链接" title="Q7: dump db 文件是 rocksdb 本身就带的功能？具体怎么搞的？的直接链接" href="/docs/序言/FAQ/#q7-dump-db-文件是-rocksdb-本身就带的功能具体怎么搞的">​</a></h4>
<p>A7: rocksdb 提供对当前 db 快照备份的功能，我们基于此，在 dump 时先对 pika 阻住用户的写，然后记录当前的 binlog 偏移量并且调用 rocksdb 的接口来拿到当前 db 的元信息，这个时候就可以放开用户写，然后基于这个元信息来进行快照数据的后台拷贝，阻写的时间很短</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q8-先写-binlog-再执行如果这时候挂了命令还没执行但是写入到-binlog-里面了怎么办">Q8: 先写 binlog 再执行，如果这时候挂了，命令还没执行，但是写入到 binlog 里面了怎么办？<a class="hash-link" aria-label="Q8: 先写 binlog 再执行，如果这时候挂了，命令还没执行，但是写入到 binlog 里面了怎么办？的直接链接" title="Q8: 先写 binlog 再执行，如  果这时候挂了，命令还没执行，但是写入到 binlog 里面了怎么办？的直接链接" href="/docs/序言/FAQ/#q8-先写-binlog-再执行如果这时候挂了命令还没执行但是写入到-binlog-里面了怎么办">​</a></h4>
<p>A8: master 是先写 db 再写 binlog，之前 slave 只用一个 worker 来同步会在 master 写入压力很大的情况下由于 slave 一个 worker 写入太慢而造成同步差距过大，后来我们调整结构，让 slave 通过多个 worker 来写提高写入速度，不过这时候有一个问题，为了保证主从 binlog 顺序一致，写 binlog 的操作还是只能又一个线程来做，也就是 receiver，所以 slave 这边是先写 binlog 再写 db，所以 slave 存在写完 binlog 挂掉导致丢失数据的问题，不过 redis 在 master 写完 db 后挂掉同样会丢失数据，所以 redis 采用全同步的办法来解决这一问题，pika 同样，默认使用部分同步来继续，如果业务对数据十分敏感，此处可以强制 slave 重启后进行全同步即可</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q9-binlogbgworker-线程之间还是要按照-binlog-顺序执行这块并发能提高多少性能">Q9: BinlogBGWorker 线程之间还是要按照 binlog 顺序执行，这块并发能提高多少性能？<a class="hash-link" aria-label="Q9: BinlogBGWorker 线程之间还是要按照 binlog 顺序执行，这块并发能提高多少性能？的直接链接" title="Q9: BinlogBGWorker 线程之间还是要按照 binlog 顺序执行，这块并发能提高多少性能？的直接链接" href="/docs/序言/FAQ/#q9-binlogbgworker-线程之间还是要按照-binlog-顺序执行这块并发能提高多少性能">​</a></h4>
<p>A9: 之前主从同步的差异是由主的多个 worker 写入而从只有一个 worker 写入带来的，现在的做法提高了从写 db 的速度，不过协议解析还是有一个线程来做，还是有瓶颈，不过这样的优化主从同步的性能提高了 3~5 倍左右，如果 key 很少的话，优化不明显，因为 slave 这面是通过 key 的 hash 值来 sharding 到其中一个 worker 上的</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q10-秒删每次-put-都要去查询-key-的最新版本也就是说每次写避免伴随一次读">Q10: 秒删，每次 put 都要去查询 key 的最新版本？也就是说每次写避免伴随一次读？<a class="hash-link" aria-label="Q10: 秒删，每次 put 都要去查询 key 的最新版本？也就是说每次写避免伴随一次读？的直接链接" title="Q10: 秒删，每次 put 都要去查询 key 的最新版本？也就是说每次写避免伴随一次读？的直接链接" href="/docs/序言/FAQ/#q10-秒删每次-put-都要去查询-key-的最新版本也就是说每次写避免伴随一次读">​</a></h4>
<p>A10: pika 多数据结构的实现主要是 “meta key + 普通 key” 来实现的，所以对于多数据结构的读写，肯定都是对 rocksdb 进行 2 次及以上的读写次数，你说的版本信息我们是存在 meta_key 中的，和其他 meta 信息一起被读出来，其实并没有因为版本号而额外增加读写次数</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q11-为什么-pika-使用多线程而不是像-redis-单线程的结构">Q11: 为什么 Pika 使用多线程而不是像 Redis 单线程的结构？<a class="hash-link" aria-label="Q11: 为什么 Pika 使用多线程而不是像 Redis 单线程的结构？的直接链接" title="Q11: 为什么 Pika 使用多线程而不是像 Redis 单线程的结构？的直接链接" href="/docs/序言/FAQ/#q11-为什么-pika-使用多线程而不是像-redis-单线程的结构">​</a></h4>
<p>A11: 因为 Redis 所有的操作都是对于内存的操作，因此理论上 Redis 的每次操作很短的。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q12-数据分片是在代理层做的集合操作落在不同的槽比如-mget是在代理层聚合的">Q12: 数据分片是在代理层做的？集合操作落在不同的槽，  比如 mget，是在代理层聚合的？<a class="hash-link" aria-label="Q12: 数据分片是在代理层做的？集合操作落在不同的槽，比如 mget，是在代理层聚合的？的直接链接" title="Q12: 数据分片是在代理层做的？集合操作落在不同的槽，比如 mget，是在代理层聚合的？的直接链接" href="/docs/序言/FAQ/#q12-数据分片是在代理层做的集合操作落在不同的槽比如-mget是在代理层聚合的">​</a></h4>
<p>A12: 目前没有对数据进行分片，你可以理解成和单机 Redis 类似，支持 master-slave 的架构，因此单个 pika 实例存储的大小的限制是磁盘大小的限制。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q13-pika-支持的客户端有哪些是否支持-pipelining">Q13: pika 支持的客户端有哪些，是否支持 pipelining？<a class="hash-link" aria-label="Q13: pika 支持的客户端有哪些，是否支持 pipelining？的直接链接" title="Q13: pika 支持的客户端有哪些，是否支持 pipelining？的直接链接" href="/docs/序言/FAQ/#q13-pika-支持的客户端有哪些是否支持-pipelining">​</a></h4>
<p>A13: pika 支持所有的 Redis 客户端，因为 pika 设计之初就考虑到了用户的迁移成本，因此各种语言的客户端都支持。pipelining 是客户端来做的，因此我们是支持 pipelining 的。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q14-为什么不考虑-redis-cluster-shard-呢">Q14: 为什么不考虑 Redis cluster shard 呢？<a class="hash-link" aria-label="Q14: 为什么不考虑 Redis cluster shard 呢？的直接链接" title="Q14: 为什么不考虑 Redis cluster shard 呢？的直接链接" href="/docs/序言/FAQ/#q14-为什么不考虑-redis-cluster-shard-呢">​</a></h4>
<p>A14: 我们开始做 pika 的时候，Redis cluster shard 还不完善，而且 Redis cluster 定位的场景和 pika 还是有区别。目前我们内部还没大范围使用 Redis cluster。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q15-不理解前面为什么加-lvsredis-类服务都是带状态负载反而用吧">Q15: 不理解前面为什么加 LVS？Redis 类服务都是带状态，负载反而用吧？<a class="hash-link" aria-label="Q15: 不理解前面为什么加 LVS？Redis 类服务都是带状态，负载反而用吧？的直接链接" title="Q15: 不理解前面为什么加 LVS？Redis 类服务都是带状态，负载反而用吧？的直接链接" href="/docs/序言/FAQ/#q15-不理解前面为什么加-lvsredis-类服务都是带状态负载反而用吧">​</a></h4>
<p>A15: 我们暴露给用户的 ip 是我们 LVS 的 ip。在 Redis 前面 LVS 是为了方便主从切换，这样可以做到用户完全不感知。这里 LVS 下面挂的多个 Redis 实例，都是 master-slave 结构的。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q16-有没有对比过-ssdbleveldb优势是什么">Q16: 有没有对比过 ssdb，LevelDB？优势是什么？<a class="hash-link" aria-label="Q16: 有没有对比过 ssdb，LevelDB？优势是什么？的直接链接" title="Q16: 有没有对比过 ssdb，LevelDB？优势是什么？的直接链接" href="/docs/序言/FAQ/#q16-有没有对比过-ssdbleveldb优势是什么">​</a></h4>
<p>A16: 我们公司内部有业务部门用 ssdb，目前除了游戏大部分的 ssdb 已经迁移到 pika 上来。我觉得 pika 的优势在于我们代码实现的比较细，性能会比较好。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q17-存储引擎为什么没有选择-leveldb-呢另外市面上有类似的方案如-ssdb有什么不同之处吗">Q17: 存储引擎为什么没有选择 LevelDB 呢，另外市面上有类似的方案如 ssdb，有什么不同之处吗？<a class="hash-link" aria-label="Q17: 存储引擎为什么没有选择 LevelDB 呢，另外市面上有类似的方案如 ssdb，有什么不同之处吗？的直接链接" title="Q17: 存储引擎为什么没有选择 LevelDB 呢，另外市面上有类似的方案如 ssdb，有什么不同之处吗？ 的直接链接" href="/docs/序言/FAQ/#q17-存储引擎为什么没有选择-leveldb-呢另外市面上有类似的方案如-ssdb有什么不同之处吗">​</a></h4>
<p>A17: 存储引擎上我们在 LevelDB，RocksDB 上面做过对比。LevelDB，RocksDB 在数据量比较小的时候性能差异不大，但是在数据量比较大的情况下，比如 200G 的时候，RocksDB 的性能会比 LevelDB 要来得好。但是 RocksDB 也有他的缺点，就是代码没有 LevelDB 来的那么优雅，我一直觉得一个好的 c++ 程序员看 LevelDB 代码和 effective c++ 就好了。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q18-若类似于单机-redis那么单机性能是个瓶颈吧大量的客户端连接命令处理以及网卡流量等">Q18: 若类似于单机 Redis，那么单机性能是个瓶颈吧？大量的客户端连接，命令处理，以及网卡流量等<a class="hash-link" aria-label="Q18: 若类似于单机 Redis，那么单机性能是个瓶颈吧？大量的客户端连接，命令处理，以及网卡流量等的直接链接" title="Q18: 若类似于单机 Redis，那么单机性能是个瓶颈吧？大量的客户端连接，命令处理，以及网卡流量等的直接链接" href="/docs/序言/FAQ/#q18-若类似于单机-redis那么单机性能是个瓶颈吧大量的客户端连接命令处理以及网卡流量等">​</a></h4>
<p>A18: 是的。所以目前内部的 pika 的架构是支持一主多从、多机房自洽的方案。目前线上最多一个主 14 个从这样的结构。DBA 可以很容易的 slaveof 给一个主挂上 slave，然后进行数据的全同步过程。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q19-pika-的多线程比-redis-的全内存在-get-上竟然快两倍set-也快不存在多线程的锁消耗吗">Q19: pika 的多线程比 Redis 的全内存，在 get 上竟然快两倍？set 也快，不存在多线程的锁消耗吗？<a class="hash-link" aria-label="Q19: pika 的多线程比 Redis 的全内存，在 get 上竟然快两倍？set 也快，不存在多线程的锁消耗吗？的直接链接" title="Q19: pika 的多线程比 Redis 的全内存，在 get 上竟然快两倍？set 也快，不存在多线程的锁消耗吗？的直接链接" href="/docs/序言/FAQ/#q19-pika-的多线程比-redis-的全内存在-get-上竟然快两倍set-也快不存在多线程的锁消耗吗">​</a></h4>
<p>A19: 这里大家可以看到，这个测试结果是 pika work thread 开了 18 个。</p>
<p>在多数据结构的接口里面 kv 的结构的性能是最好的，而多数据结构的接口比如 hash、zset 等等就算开了 18 个线程，性能依然不如 Redis 要来得好。因为 hash、zset 等数据结构需要有抢占多数据结构元数据锁的开销，因此性能很容易下来。但是 kv 接口基本没有锁的开销。唯一的锁开销就是 RocksDB 为了实现线程安全增加的锁，因此这个结果也是可以理解了。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q20-完全是因为分布式切片不均的缘故而放弃分布式集群吗m-s-架构每个节点不都是全量数据占用更多资源吗">Q20: 完全是因为分布式切片不均的缘故，而放弃分布式集群吗？m-s 架构每个节点不都是全量数据，占用更多资源吗？<a class="hash-link" aria-label="Q20: 完全是因为分布式切片不均的缘故，而放弃分布式集群吗？m-s 架构每个节点不都是全量数据，占用更多资源吗？的直接链接" title="Q20: 完全是因为分布式切片不均的缘故，而放弃分布式集群吗？m-s 架构每个节点不都是全量数据，占用更多资源吗？的直接链接" href="/docs/序言/FAQ/#q20-完全是因为分布式切片不均的缘故而放弃分布式集群吗m-s-架构每个节点不都是全量数据占用更多资源吗">​</a></h4>
<p>A20: 其实我们在 bada 里面增加了多数据结构的接口，并且兼容了 Redis 的协议，但是后来用户的使用中，发现其实使用多数据结构接口的用户数据量其  实不是特别大。单机 1T 的盘基本都能够承受下来。但是还是因为 Hash 分布式切片不均衡，导致我们的维护成本增加，因此我们去实现了 m-s 架构方案。</p>
<p>目前 bada 的方案也是和 pika 并存的方案，我们会根据用户具体的使用场景推荐使用的存储方案。我一直觉得肯定不是一套存储方案解决公司内部的所有需求，一定是某一个方案更适用于某一种存储方案。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q21-除了类比为单机-redis-外有没有考虑分布式支持比如-redis-的-sentinel-或者支持-codis-这样可能其它-redis-集群可以无缝迁移">Q21: 除了类比为单机 Redis 外，有没有考虑分布式支持？比如 Redis 的 sentinel 或者支持 Codis 这样可能其它 Redis 集群可以无缝迁移。<a class="hash-link" aria-label="Q21: 除了类比为单机 Redis 外，有没有考虑分布式支持？比如 Redis 的 sentinel 或者支持 Codis 这样可能其它 Redis 集群可以无缝迁移。的直接链接" title="Q21: 除了类比为单机 Redis 外，有没有考虑分布式支持？比如 Redis 的 sentinel 或者支持 Codis 这样可能其它 Redis 集群可以无缝迁移。的直接链接" href="/docs/序言/FAQ/#q21-除了类比为单机-redis-外有没有考虑分布式支持比如-redis-的-sentinel-或者支持-codis-这样可能其它-redis-集群可以无缝迁移">​</a></h4>
<p>A21: Pika 目前并没有使用类似 Redis 的 sentinel，pika 前面是挂 LVS 来负责主从切换。目前也没有使用 Codis 这样的 proxy 方案。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q22-一主-14-个从主从同步岂不是很慢另外从是只读的吧读从的话从的数据可能是过期的数据一致性怎么解决">Q22: 一主 14 个从？主从同步岂不是很慢？另外，从是只读的吧，读从的话，从的数据可能是过期的，数据一致性怎么解决？<a class="hash-link" aria-label="Q22: 一主 14 个从？ 主从同步岂不是很慢？另外，从是只读的吧，读从的话，从的数据可能是过期的，数据一致性怎么解决？的直接链接" title="Q22: 一主 14 个从？主从同步岂不是很慢？另外，从是只读的吧，读从的话，从的数据可能是过期的，数据一致性怎么解决？的直接链接" href="/docs/序言/FAQ/#q22-一主-14-个从主从同步岂不是很慢另外从是只读的吧读从的话从的数据可能是过期的数据一致性怎么解决">​</a></h4>
<p>A22: 一主 14 从的场景是用户的写入都是晚上定期的灌数据，读取的话从各个从库进行读取。因此这个数据一致性是用户可以接受的场景。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q23-设置了-expire-logs-nums-至少为-10-和-binlog-过期时间为何-master-中仍然有大量的-write2file-文件">Q23: 设置了 expire-logs-nums (至少为 10) 和 binlog 过期时间，为何 master 中仍然有大量的 write2file 文件？<a class="hash-link" aria-label="Q23: 设置了 expire-logs-nums (至少为 10) 和 binlog 过期时间，为何 master 中仍然有大量的 write2file 文件？的直接链接" title="Q23: 设置了 expire-logs-nums (至少为 10) 和 binlog 过期时间，为何 master 中仍然有大量的 write2file 文件？的直接链接" href="/docs/序言/FAQ/#q23-设置了-expire-logs-nums-至少为-10-和-binlog-过期时间为何-master-中仍然有大量的-write2file-文件">​</a></h4>
<p>A23: pika 会定期检查 binlog 文件，如果 binlog 数目超过了 expire-logs-nums 或者过期时间，并且所有的从节点都已经对该 binlog 文件进行过同步，那么 binlog 文件就会被删除。确认过 expire-logs-nums 和过期时间设置正确，可以通过 info 命令查看是否有从节点同步延迟比较大，导致 binlog 无法被删除。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="q24-30-进行读写时blackwidow-只对写加锁对读不加锁是否会发生脏读">Q24<!-- -->:Pika<!-- --> 3.0 进行读写时，blackwidow 只对写加锁，对读不加锁，是否会发生脏读？<a class="hash-link" aria-label="q24-30-进行读写时blackwidow-只对写加锁对读不加锁是否会发生脏读的直接链接" title="q24-30-进行读写时blackwidow-只对写加锁对读不加锁是否会发生脏读的直接链接" href="/docs/序言/FAQ/#q24-30-进行读写时blackwidow-只对写加锁对读不加锁是否会发生脏读">​</a></h4>
<p>A24: 不会有脏读问题， Pika Blackwidow (最新代码在 src/storage) 进行 Get 操作使用的是 default_read_options_, snapshot 是 nullptr, 所以是调用时刻的隐式快照。更详细解释详见 <a href="https://github.com/OpenAtomFoundation/pika/issues/185#issuecomment-1548935380" target="_blank" rel="noopener noreferrer">issue 185</a>。</p>
<p>如果您有其他问题，请联系直接在 github issue 上描述您的问题，我们第一时间回复。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/OpenAtomFoundation/PikiwiDB-Pika--Website/tree/main/docs/序言/FAQ/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/序言/支持的 Redis 接口与兼容情况/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">支持的 Redis 接口与兼容情况</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/使用与运维/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">使用与运维</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/序言/FAQ/#1-编译安装">1 编译安装</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/序言/FAQ/#2-设计与实现">2 设计与实现</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">微信公众号</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://mp.weixin.qq.com/s/CvIdQs3g31DC8JztyymuqQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">PikiwiDB(Pika) 公众号<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Github 仓库</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/OpenAtomFoundation/pika" target="_blank" rel="noopener noreferrer" class="footer__link-item">PikiwiDB(Pika) 仓库<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">文档仓库</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/OpenAtomFoundation/PikiwiDB-Pika--Website" target="_blank" rel="noopener noreferrer" class="footer__link-item">PikiwiDB(Pika) 文档仓库<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 PikiwiDB(Pika) 开源数据库社区</div></div></div></footer></div>
</body>
</html>