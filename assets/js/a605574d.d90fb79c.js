"use strict";(self.webpackChunkPikiwiDB_Pika_=self.webpackChunkPikiwiDB_Pika_||[]).push([[4487],{7012:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>b});var n=s(4848),t=s(8453);const a={title:"Pubsub \u673a\u5236",sidebar_position:1},d=void 0,r={id:"\u8bbe\u8ba1\u4e0e\u5b9e\u73b0/Pika \u6e90\u7801\u5b66\u4e60\u7b14\u8bb0/PubSub \u673a\u5236/index",title:"Pubsub \u673a\u5236",description:"\u524d\u4e00\u7bc7\u300aPika\u6e90\u7801\u5b66\u4e60--pika\u7684\u901a\u4fe1\u548c\u7ebf\u7a0b\u6a21\u578b\u300b\u91cc\u8bf4\u5230WorkerThread\u91cc\u9762\u6709\u4e24\u79cd\u5904\u7406\u547d\u4ee4\u7684\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f\u540c\u6b65\uff0c\u4e00\u79cd\u662f\u5f02\u6b65\u3002\u90a3\u4ec0\u4e48\u65f6\u5019\u662f\u540c\u6b65\u5904\u7406\uff0c\u4ec0\u4e48\u65f6\u5019\u662f\u5f02\u6b65\u5904\u7406\u5462\uff1f\u5176\u5b9e",source:"@site/docs/\u8bbe\u8ba1\u4e0e\u5b9e\u73b0/Pika \u6e90\u7801\u5b66\u4e60\u7b14\u8bb0/PubSub \u673a\u5236/index.md",sourceDirName:"\u8bbe\u8ba1\u4e0e\u5b9e\u73b0/Pika \u6e90\u7801\u5b66\u4e60\u7b14\u8bb0/PubSub \u673a\u5236",slug:"/\u8bbe\u8ba1\u4e0e\u5b9e\u73b0/Pika \u6e90\u7801\u5b66\u4e60\u7b14\u8bb0/PubSub \u673a\u5236/",permalink:"/docs/\u8bbe\u8ba1\u4e0e\u5b9e\u73b0/Pika \u6e90\u7801\u5b66\u4e60\u7b14\u8bb0/PubSub \u673a\u5236/",draft:!1,unlisted:!1,editUrl:"https://github.com/OpenAtomFoundation/PikiwiDB-Pika--Website/tree/main/docs/\u8bbe\u8ba1\u4e0e\u5b9e\u73b0/Pika \u6e90\u7801\u5b66\u4e60\u7b14\u8bb0/PubSub \u673a\u5236/index.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Pubsub \u673a\u5236",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"\u901a\u4fe1\u548c\u7ebf\u7a0b\u6a21\u578b",permalink:"/docs/\u8bbe\u8ba1\u4e0e\u5b9e\u73b0/Pika \u6e90\u7801\u5b66\u4e60\u7b14\u8bb0/\u901a\u4fe1\u548c\u7ebf\u7a0b\u6a21\u578b/"},next:{title:"Pika \u7684\u547d\u4ee4\u6267\u884c\u6846\u67b6",permalink:"/docs/\u8bbe\u8ba1\u4e0e\u5b9e\u73b0/Pika \u6e90\u7801\u5b66\u4e60\u7b14\u8bb0/Pika \u7684\u547d\u4ee4\u6267\u884c\u6846\u67b6/"}},c={},b=[];function h(e){const i={img:"img",p:"p",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.p,{children:"\u524d\u4e00\u7bc7\u300aPika\u6e90\u7801\u5b66\u4e60--pika\u7684\u901a\u4fe1\u548c\u7ebf\u7a0b\u6a21\u578b\u300b\u91cc\u8bf4\u5230WorkerThread\u91cc\u9762\u6709\u4e24\u79cd\u5904\u7406\u547d\u4ee4\u7684\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f\u540c\u6b65\uff0c\u4e00\u79cd\u662f\u5f02\u6b65\u3002\u90a3\u4ec0\u4e48\u65f6\u5019\u662f\u540c\u6b65\u5904\u7406\uff0c\u4ec0\u4e48\u65f6\u5019\u662f\u5f02\u6b65\u5904\u7406\u5462\uff1f\u5176\u5b9e\nClientConnFactory\u8fd4\u56de\u7684PikaClientConn\u9ed8\u8ba4\u90fd\u662f\u5f02\u6b65\u7684\u3002"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(8824).A+"",width:"554",height:"140"})}),"\n",(0,n.jsx)(i.p,{children:"\u540c\u6b65\u662f\u5728\u8ba2\u9605\u63a8\u9001\u91cc\u9762\u7528\u5230\uff0c\u6211\u4eec\u6765\u4e86\u89e3\u4e00\u4e0bpika\u7684PubSub\u673a\u5236\uff0c\u8fd9\u91cc\u4ee5Subscribe/UnSubscribe\u547d\u4ee4\u4e3a\u4f8b\u3002"}),"\n",(0,n.jsx)(i.p,{children:"1\u3001PubSub\u7ebf\u7a0b"}),"\n",(0,n.jsx)(i.p,{children:"PikaServer\u91cc\u9762\u5355\u72ec\u8d77\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u7528\u6765\u5904\u7406\u8ba2\u9605\u63a8\u9001\u7684\u6d88\u606f"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(4422).A+"",width:"554",height:"96"})}),"\n",(0,n.jsx)(i.p,{children:"PubSubThread\u6784\u9020\u51fd\u6570\u91cc\u9762\u521b\u5efa\u4e86\u4e24\u4e2a\u7ba1\u9053\uff0c\u548c\u524d\u9762\u4ecb\u7ecd\u7684\u4e00\u6837\uff0c\u8fd9\u91cc\u7684\u7ba1\u9053\u662f\u7528\u6765\u7ebf\u7a0b\u95f4\u901a\u4fe1\u7528\u7684\uff0c\u5176\u4e2dmsg_pfd_\u662f\u6709\u63a8\u9001\u6d88\u606f\u5230\u6765\u65f6\u901a\u77e5\u8fdb\u884c\u63a8\u9001\uff0cnotify_pfd_\u662f\u7528\u4e8e\u8fde\u63a5\u7684\u52a0\u5165\u3002"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(6189).A+"",width:"554",height:"266"})}),"\n",(0,n.jsx)(i.p,{children:"PubSubThread\u7ee7\u627fThread\uff0c\u4e3b\u903b\u8f91\u5165\u53e3\u662fPubSubThread::ThreadMain\uff0c\u5728ThreadMain\u91cc\u9762\u4e3b\u8981\u5904\u7406\u65b0\u8fde\u63a5\u52a0\u5165\uff0c\u63a8\u9001\uff0c\u4ee5\u53ca\u8fde\u63a5\u7684\u6d88\u606f\uff0c\u8fd9\u51e0\u90e8\u5206\u9700\u8981\u5206\u522b\u7ed3\u5408\u4e0b\u9762\u7684\u4ecb\u7ecd\u6765\u8bf4\u660e\u3002"}),"\n",(0,n.jsx)(i.p,{children:"2\u3001Subscribe"}),"\n",(0,n.jsx)(i.p,{children:"Subscribe\u547d\u4ee4\u7684\u5165\u53e3\u662fSubscribeCmd::Do\uff0c\u8fd9\u91cc\u9664\u4e86\u6267\u884cSubscribe\u4e3b\u903b\u8f91\u5916\uff0c\u8fd8\u505a\u4e86\u4e0b\u56fe\u6846\u8d77\u6765\u7684\u4e24\u4e2a\u5173\u952e\u7684\u52a8\u4f5c"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(2948).A+"",width:"554",height:"243"})}),"\n",(0,n.jsx)(i.p,{children:"\u628a\u8fde\u63a5\u7684fd\u4eceWorkerThread\u7ebf\u7a0b\u7684epoll\u4e2d\u5220\u9664WorkerThread::MoveConnOut\uff0c\u8bbe\u7f6ePubSub\u6807\u8bb0\u5e76\u4e14\u628a\u8fde\u63a5\u7684HandleType\u6539\u4e3a\u540c\u6b65\u6a21\u5f0f\u3002\u6211\u4eec\u518d\u770b\u4e0bSubscribe\u91cc\u9762\u505a\u4e86\u5565\u3002\u8ba2\u9605\u672c\u8eab\u7684\u903b\u8f91\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u6784\u9020\u4e86\u4e00\u4e2achannel\u548cconn\u6570\u7ec4\u7684Map pubsub_channel_\uff0c\u7136\u540e\u628achannel\u548cconn\u5f80\u8fd9\u4e2amap\u4e0a\u52a0\u3002"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(7755).A+"",width:"554",height:"598"})}),"\n",(0,n.jsx)(i.p,{children:"\u6211\u4eec\u770b\u4e0b\u6700\u4e0b\u9762\u7684\u7ea2\u6846\uff0c\u524d\u9762\u628a\u8fde\u63a5\u7684fd\u4eceWorkerThread\u91cc\u9762\u5220\u9664\uff0c\u8fd9\u91cc\u628a\u8fd9\u4e2afd\u653e\u5230fd_queue\uff0c\u7136\u540e\u5199\u4e86\u4e00\u4e2a\u7ba1\u9053\u6d88\u606f\u901a\u77e5PubSub\u7ebf\u7a0b\u5904\u7406\uff0c\u6211\u4eec\u770b\u4e0bPubSubThread::ThreadMain\uff0c\u5982\u679c\u662fnotify_pfd_\u6765\u7684\u6d88\u606f\uff0c\u4f1a\u628afd\u52a0\u5230PubSubThread\u81ea\u5df1\u7684epoll\uff0c\u6240\u4ee5\u5982\u679c\u6709subscribe\u547d\u4ee4\u8fc7\u6765\u7684\u65f6\u5019\uff0c\u4f1a\u628a\u8fd9\u4e2a\u8fde\u63a5\u7684fd\u4eceWorkerThread\u8f6c\u79fb\u5230PubSubThread\u8fd9\u4e2a\u5355\u72ec\u7684\u7ebf\u7a0b\u6765\u5904\u7406\u3002"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(6210).A+"",width:"554",height:"276"})}),"\n",(0,n.jsx)(i.p,{children:"3\u3001UnSubscribe\nUnSubscribe\u547d\u4ee4\u7684\u5165\u53e3\u662fSubscribeCmd::Do\uff0c\u7406\u89e3\u4e86Subscribe\u7684\u903b\u8f91\u540e\uff0cUnSubscribe\u7684\u903b\u8f91\u5c31\u6bd4\u8f83\u597d\u7406\u89e3\u4e86\uff0c\u56e0\u4e3a\u4ed6\u505a\u4e86\u548cSubscribe\u76f8\u53cd\u7684\u64cd\u4f5c\uff1aPubSubThread::UnSubscribe\u91cc\u9762\u4f1aRemoveConn\uff0c\u628a\u8fde\u63a5fd\u4ecePubSubThread\u7684epoll\u5220\u9664\uff1b\u7136\u540e\u628a\u8fde\u63a5\u52a0\u56deWorkerThread\u7684epoll\uff0cPubSub\u6807\u8bb0\u7f6e\u4e3afalse"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(4393).A+"",width:"554",height:"264"})}),"\n",(0,n.jsx)(i.p,{children:"4\u3001Publish\nPublish\u547d\u4ee4\u7684\u5165\u53e3\u662fPublishCmd::Do\uff0c\u4e3b\u8981\u903b\u8f91\u662f\u53d1\u7ba1\u9053\u6d88\u606f\u901a\u77e5PubSubThread\u4e3b\u7ebf\u7a0b\u6765\u5904\u7406\u63a8\u9001"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(192).A+"",width:"554",height:"234"})}),"\n",(0,n.jsx)(i.p,{children:"PubSubThread::ThreadMain\u5982\u679c\u6536\u5230\u63a8\u9001\u7684\u901a\u77e5\uff0c\u5219\u6839\u636e\u8ba2\u9605\u5173\u7cfb\u8fdb\u884c\u63a8\u9001"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(4423).A+"",width:"554",height:"366"})}),"\n",(0,n.jsx)(i.p,{children:"5\u3001\u5df2\u8ba2\u9605\u8fde\u63a5\u547d\u4ee4\u7684\u5904\u7406\n\u4e3a\u5565\u9700\u8981\u628a\u8ba2\u9605\u7684fd\u79fb\u5230\u5355\u72ec\u7684PubSubThread\u7ebf\u7a0b\uff0c\u5e76\u4e14\u7528\u540c\u6b65\u5904\u7406\u5462\uff1f\u628a\u8ba2\u9605\u8fde\u63a5fd\u79fb\u5230PubSubThread\u7ebf\u7a0b\u540e\uff0c\u5904\u7406\u5df2\u6709\u8fde\u63a5\u7684\u6d88\u606f\u7684\u903b\u8f91\u5176\u5b9e\u548c\u5728WorkerThread\u7c7b\u4f3c\uff0c\u4e5f\u662f\u7528RedisConn::GetRequest\u6765\u5904\u7406\u8bf7\u6c42\uff0c\u53ea\u4e0d\u8fc7\u5904\u7406\u7c7b\u578b\u53d8\u6210\u4e86\u540c\u6b65\u3002"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(8638).A+"",width:"494",height:"539"})}),"\n",(0,n.jsx)(i.p,{children:"\u4ece\u524d\u4e00\u7bc7\u6587\u7ae0\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u540c\u6b65\u7684\u5904\u7406\u662f\u5728ParserDealMessageCb\u51fd\u6570"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(2740).A+"",width:"554",height:"108"})}),"\n",(0,n.jsx)(i.p,{children:"\u7406\u8bba\u4e0a\u8bb2\u8fd9\u4e2aPikaClientConn::DealMessage\u5e94\u8be5\u662f\u8981\u5b9e\u73b0\u7684\u624d\u5bf9\uff0c\u4f46\u662f\u6211\u4e0b\u7684\u6700\u65b0\u7684\u4ee3\u7801\u53d1\u73b0\u8fd9\u4e2a\u51fd\u6570\u88ab\u6539\u6ca1\u4e86\uff08commitid: c9f2a66b1741a9148402b42128f46c36d3d83444\uff09"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(6637).A+"",width:"554",height:"48"})}),"\n",(0,n.jsx)(i.p,{children:"\u5728commit\u8bb0\u5f55\u91cc\u9762\u627e\u5230\u4e86\u4e4b\u524d\u7684\u5b9e\u73b0\uff0c\u6682\u65f6\u6ca1\u6709\u7814\u7a76\u8fd9\u4e2a\u4e3a\u5565\u8fd9\u6837\u6539\uff0c\u5148\u6309\u4ee5\u524d\u7684\u4ee3\u7801\u770b\uff0c\u4e0d\u5f71\u54cd\u5bf9\u6574\u4e2a\u903b\u8f91\u7684\u7406\u89e3\u3002\u53ef\u4ee5\u770b\u5230DealMessage\u5b9e\u9645\u4e0a\u4e5f\u662f\u8c03\u7528\u4e86PikaClientConn::DoCmd\u3002"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(2662).A+"",width:"554",height:"307"})}),"\n",(0,n.jsx)(i.p,{children:"\u56e0\u4e3aredis\u7684PubSub\u5b9e\u73b0\u662f\u8fd9\u6837\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u5ba2\u6237\u7aef\u6b63\u5728\u8ba2\u9605\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5ba2\u6237\u7aef\u53ea\u80fd\u6267\u884cSubscribe/UnSubscribe/PSubscribe/UnSubscribe/Ping\u8fd9\u51e0\u4e2a\u547d\u4ee4\uff0c\u8ba2\u9605\u548c\u53d6\u6d88\u8ba2\u9605\u662f\u6709\u65f6\u5e8f\u5173\u7cfb\u7684\uff0c\u800cping\u547d\u4ee4\u662f\u53ef\u4ee5\u76f4\u63a5\u5904\u7406\u7684\uff0c\u6240\u4ee5\u8fd9\u91cc\u5e94\u8be5\u662f\u4e3a\u4e86\u907f\u514d\u8ba2\u9605\u548c\u53d6\u6d88\u8ba2\u9605\u53d1\u751f\u65f6\u5e8f\u9519\u8bef\uff0c\u6240\u4ee5\u628a\u8ba2\u9605\u7684\u8fde\u63a5\u79fb\u5230\u5355\u72ec\u7684\u7ebf\u7a0bPubSubThread\u6765\u5904\u7406\uff0c\u5e76\u4e14\u4f7f\u7528\u540c\u6b65\u7684\u5904\u7406\u65b9\u5f0f\u3002"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"alt text",src:s(9599).A+"",width:"554",height:"159"})})]})}function u(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},4422:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-1-73f773e065a7f4db8e884c876767aa6d.png"},2740:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-10-5469cee1ab6d47996e06cce5681cfde4.png"},6637:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-11-16e9fbeada8c7a1b6db7949bffee597a.png"},2662:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-12-8e255fa3b354119ac26c7f09de1a26b6.png"},9599:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-13-0fea61a46c039eff667cf42449fdc7dc.png"},6189:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-2-4f3ceaebe71d52832af642ed1720bfaf.png"},2948:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-3-24ad1477d3eae8722a90467818d9c69c.png"},7755:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-4-a5c268580385ecbd02dd7078aa328259.png"},6210:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-5-37862647d0f631499532685d0e88b27e.png"},4393:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-6-082780f16045bddafcca6f4adad51ed7.png"},192:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-7-68db181908ccd6249f1d2b31f8cd6d97.png"},4423:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-8-6c0e3de67866aabdf733d6ffd7c304c6.png"},8638:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-9-2e2593ad7ed0974d5f98456801ba4e24.png"},8824:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/image-0f19e5ab8e50d1da87f1f2e510633680.png"},8453:(e,i,s)=>{s.d(i,{R:()=>d,x:()=>r});var n=s(6540);const t={},a=n.createContext(t);function d(e){const i=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function r(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),n.createElement(a.Provider,{value:i},e.children)}}}]);